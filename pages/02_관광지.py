import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium

# ì„œìš¸ ì£¼ìš” ê´€ê´‘ì§€ ë°ì´í„° + ì§€í•˜ì²  ì •ë³´
places = [
    {"ì´ë¦„": "ê²½ë³µê¶", "ìœ„ë„": 37.579617, "ê²½ë„": 126.977041,
     "ì„¤ëª…": "ì¡°ì„ ì˜ ì •ê¶ì´ì ì„œìš¸ ëŒ€í‘œ ê¶ê¶", "ì—­": "ê²½ë³µê¶ì—­(3í˜¸ì„ )"},
    {"ì´ë¦„": "ëª…ë™", "ìœ„ë„": 37.563757, "ê²½ë„": 126.982682,
     "ì„¤ëª…": "ì‡¼í•‘ê³¼ ë¨¹ê±°ë¦¬ì˜ ì¤‘ì‹¬ì§€", "ì—­": "ëª…ë™ì—­(4í˜¸ì„ )"},
    {"ì´ë¦„": "ë‚¨ì‚°íƒ€ì›Œ(Nì„œìš¸íƒ€ì›Œ)", "ìœ„ë„": 37.551169, "ê²½ë„": 126.988227,
     "ì„¤ëª…": "ì„œìš¸ì˜ ì „ë§ ëª…ì†Œ, ì•¼ê²½ ëª…ë‹¹", "ì—­": "ì¶©ë¬´ë¡œì—­(3,4í˜¸ì„ )"},
    {"ì´ë¦„": "ë¶ì´Œí•œì˜¥ë§ˆì„", "ìœ„ë„": 37.582604, "ê²½ë„": 126.983998,
     "ì„¤ëª…": "ì „í†µê³¼ í˜„ëŒ€ê°€ ê³µì¡´í•˜ëŠ” í•œì˜¥ ê±°ë¦¬", "ì—­": "ì•ˆêµ­ì—­(3í˜¸ì„ )"},
    {"ì´ë¦„": "í™ëŒ€ê±°ë¦¬", "ìœ„ë„": 37.555226, "ê²½ë„": 126.923943,
     "ì„¤ëª…": "ì ŠìŒê³¼ ì˜ˆìˆ ì˜ ê±°ë¦¬", "ì—­": "í™ëŒ€ì…êµ¬ì—­(2í˜¸ì„ )"},
    {"ì´ë¦„": "ë™ëŒ€ë¬¸ë””ìì¸í”Œë¼ì(DDP)", "ìœ„ë„": 37.566478, "ê²½ë„": 127.009041,
     "ì„¤ëª…": "ë¯¸ë˜ì  ê±´ì¶•ê³¼ ì „ì‹œì˜ ê³µê°„", "ì—­": "ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›ì—­(2,4,5í˜¸ì„ )"},
    {"ì´ë¦„": "í•œê°•ê³µì›", "ìœ„ë„": 37.528708, "ê²½ë„": 126.934889,
     "ì„¤ëª…": "ì„œìš¸ ì‹œë¯¼ì˜ ëŒ€í‘œ íœ´ì‹ ëª…ì†Œ", "ì—­": "ì—¬ì˜ë‚˜ë£¨ì—­(5í˜¸ì„ )"},
    {"ì´ë¦„": "ì¸ì‚¬ë™", "ìœ„ë„": 37.574009, "ê²½ë„": 126.984913,
     "ì„¤ëª…": "í•œêµ­ ì „í†µ ë¬¸í™”ì™€ ê³µì˜ˆ ê±°ë¦¬", "ì—­": "ì¢…ë¡œ3ê°€ì—­(1,3,5í˜¸ì„ )"},
    {"ì´ë¦„": "ë¡¯ë°ì›”ë“œ", "ìœ„ë„": 37.511000, "ê²½ë„": 127.098000,
     "ì„¤ëª…": "ë„ì‹¬ ì† í…Œë§ˆíŒŒí¬", "ì—­": "ì ì‹¤ì—­(2,8í˜¸ì„ )"},
    {"ì´ë¦„": "ì ì‹¤ ë¡¯ë°íƒ€ì›Œ", "ìœ„ë„": 37.513068, "ê²½ë„": 127.102538,
     "ì„¤ëª…": "í•œêµ­ ìµœê³ ì¸µ ë¹Œë”©ê³¼ ì „ë§ëŒ€", "ì—­": "ì ì‹¤ì—­(2,8í˜¸ì„ )"},
]

df = pd.DataFrame(places)

# ì œëª©
st.title("ğŸ—ºï¸ ì™¸êµ­ì¸ì´ ì¢‹ì•„í•˜ëŠ” ì„œìš¸ ê´€ê´‘ì§€ Top10 ì§€ë„ (Folium + Subway Info)")

# ì§€ë„ ìƒì„±
seoul_map = folium.Map(location=[37.5665, 126.9780], zoom_start=12)

# ë¹¨ê°„ ë§ˆì»¤ + íŒì—… í•œ ì¤„ í‘œì‹œ
for _, row in df.iterrows():
    popup_text = f"{row['ì´ë¦„']} - {row['ì„¤ëª…']} / {row['ì—­']}"
    folium.Marker(
        location=[row["ìœ„ë„"], row["ê²½ë„"]],
        popup=popup_text,
        tooltip=row["ì´ë¦„"],
        icon=folium.Icon(color="red", icon="info-sign")
    ).add_to(seoul_map)

# ì§€ë„ í‘œì‹œ (70% í¬ê¸°)
st_folium(seoul_map, width=490, height=350)

# ê´€ê´‘ì§€ ì„¤ëª… í…Œì´ë¸”
st.markdown("### ğŸ“ ê´€ê´‘ì§€ ìš”ì•½")
st.dataframe(df[["ì´ë¦„", "ì„¤ëª…", "ì—­"]], use_container_width=True)

# ---------------------------
# ì—¬í–‰ ì¼ì • ìƒì„±
# ---------------------------
st.markdown("### ğŸ—“ï¸ ì—¬í–‰ ì¼ì • ë§Œë“¤ê¸°")
days = st.radio("ëª‡ ì¼ ë™ì•ˆ ì—¬í–‰í• ê¹Œìš”?", [1, 2, 3], index=0, horizontal=True)

if st.button("ì¼ì • ìƒì„±"):
    num_days = int(days)
    plan = []
    per_day = len(df) // num_days
    extra = len(df) % num_days
    idx = 0

    for d in range(1, num_days+1):
        day_places = df.iloc[idx: idx+per_day]
        if extra > 0:
            day_places = pd.concat([day_places, df.iloc[[idx+per_day]]])
            idx += 1
            extra -= 1
        idx += per_day
        plan.append((d, day_places))

    for day, day_df in plan:
        st.markdown(f"**Day {day}**")
        st.table(day_df[["ì´ë¦„", "ì„¤ëª…", "ì—­"]])
